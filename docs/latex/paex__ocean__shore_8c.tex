\doxysection{paex\+\_\+ocean\+\_\+shore.\+c File Reference}
\hypertarget{paex__ocean__shore_8c}{}\label{paex__ocean__shore_8c}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}


Generate Pink Noise using Gardner method, and make "{}waves"{}. Provides an example of how to post stuff to/from the audio callback using lock-\/free FIFOs implemented by the PA ringbuffer.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$time.\+h$>$}\newline
{\ttfamily \#include "{}portaudio.\+h"{}}\newline
{\ttfamily \#include "{}pa\+\_\+ringbuffer.\+h"{}}\newline
{\ttfamily \#include "{}pa\+\_\+util.\+h"{}}\newline
\doxysubsubsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_pink_noise}{Pink\+Noise}}
\item 
struct \mbox{\hyperlink{struct_bi_quad}{Bi\+Quad}}
\item 
struct \mbox{\hyperlink{struct_ocean_wave}{Ocean\+Wave}}
\item 
struct \mbox{\hyperlink{structpa_test_data}{pa\+Test\+Data}}
\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{paex__ocean__shore_8c_aacad2d0d75b07d001133a8227bb16a09}\label{paex__ocean__shore_8c_aacad2d0d75b07d001133a8227bb16a09} 
\#define {\bfseries PINK\+\_\+\+MAX\+\_\+\+RANDOM\+\_\+\+ROWS}~(30)
\item 
\Hypertarget{paex__ocean__shore_8c_a543ce37e1e5c7fde4ec39c832136683c}\label{paex__ocean__shore_8c_a543ce37e1e5c7fde4ec39c832136683c} 
\#define {\bfseries PINK\+\_\+\+RANDOM\+\_\+\+BITS}~(24)
\item 
\Hypertarget{paex__ocean__shore_8c_a2bc95aedc61109291640be3c2847d21d}\label{paex__ocean__shore_8c_a2bc95aedc61109291640be3c2847d21d} 
\#define {\bfseries PINK\+\_\+\+RANDOM\+\_\+\+SHIFT}~((sizeof(long)\texorpdfstring{$\ast$}{*}8)-\/PINK\+\_\+\+RANDOM\+\_\+\+BITS)
\item 
\Hypertarget{paex__ocean__shore_8c_a34df5bd2cb5b7e429e8041a7cb92da91}\label{paex__ocean__shore_8c_a34df5bd2cb5b7e429e8041a7cb92da91} 
\#define {\bfseries NEW\+\_\+\+ROW\+\_\+\+SIZE}~(12 + (8\texorpdfstring{$\ast$}{*}rand())/RAND\+\_\+\+MAX)
\end{DoxyCompactItemize}
\doxysubsubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum {\bfseries Env\+State} \{ {\bfseries State\+\_\+k\+Attack}
, {\bfseries State\+\_\+k\+Pre\+Decay}
, {\bfseries State\+\_\+k\+Decay}
, {\bfseries State\+\_\+k\+Cnt}
 \}
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{paex__ocean__shore_8c_af0dae67ebb88c9e578848aa1fceaf8f8}{Initialize\+Pink\+Noise}} (\mbox{\hyperlink{struct_pink_noise}{Pink\+Noise}} \texorpdfstring{$\ast$}{*}pink, int num\+Rows)
\item 
float \mbox{\hyperlink{paex__ocean__shore_8c_acfbee971d40a150d4a00611ed7b69cd3}{Generate\+Pink\+Noise}} (\mbox{\hyperlink{struct_pink_noise}{Pink\+Noise}} \texorpdfstring{$\ast$}{*}pink)
\item 
unsigned \mbox{\hyperlink{paex__ocean__shore_8c_aac16b3933990e9a8bddb66b509789dae}{Generate\+Wave}} (\mbox{\hyperlink{struct_ocean_wave}{Ocean\+Wave}} \texorpdfstring{$\ast$}{*}wave, float \texorpdfstring{$\ast$}{*}output, unsigned no\+Of\+Frames)
\item 
float \mbox{\hyperlink{paex__ocean__shore_8c_aa24e8a7f0ab18cae3d70fc59689e4273}{Process\+Biquad}} (const \mbox{\hyperlink{struct_bi_quad}{Bi\+Quad}} \texorpdfstring{$\ast$}{*}coeffs, float \texorpdfstring{$\ast$}{*}memory, float input)
\item 
\mbox{\hyperlink{struct_ocean_wave}{Ocean\+Wave}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{paex__ocean__shore_8c_a6f53cca6e132a7847315f74f04a50340}{Initialize\+Wave}} (double SR, float attack\+In\+Seconds, float max\+Level, float position\+Left\+Right)
\item 
int \mbox{\hyperlink{paex__ocean__shore_8c_a840291bc02cba5474a4cb46a9b9566fe}{main}} (void)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Generate Pink Noise using Gardner method, and make "{}waves"{}. Provides an example of how to post stuff to/from the audio callback using lock-\/free FIFOs implemented by the PA ringbuffer. 

Optimization suggested by James Mc\+Cartney uses a tree to select which random value to replace. 
\begin{DoxyPre}
    x x x x x x x x x x x x x x x x
    x   x   x   x   x   x   x   x
    x       x       x       x
     x               x
       x
\end{DoxyPre}
 Tree is generated by counting trailing zeros in an increasing index. When the index is zero, no random number is selected.

\begin{DoxyAuthor}{Author}
Phil Burk \href{http://www.softsynth.com}{\texttt{ http\+://www.\+softsynth.\+com}} Robert Bielik 
\end{DoxyAuthor}


\doxysubsection{Enumeration Type Documentation}
\Hypertarget{paex__ocean__shore_8c_a6ef105f364067626d9f25c5589aaff2e}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!EnvState@{EnvState}}
\index{EnvState@{EnvState}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{EnvState}{EnvState}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_a6ef105f364067626d9f25c5589aaff2e} 
enum Env\+State}


\begin{DoxyCode}{0}
\DoxyCodeLine{00093\ \{}
\DoxyCodeLine{00094\ \ \ \ \ State\_kAttack,}
\DoxyCodeLine{00095\ \ \ \ \ State\_kPreDecay,}
\DoxyCodeLine{00096\ \ \ \ \ State\_kDecay,}
\DoxyCodeLine{00097\ \ \ \ \ State\_kCnt,}
\DoxyCodeLine{00098\ \}\ EnvState;}

\end{DoxyCode}


\doxysubsection{Function Documentation}
\Hypertarget{paex__ocean__shore_8c_acfbee971d40a150d4a00611ed7b69cd3}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!GeneratePinkNoise@{GeneratePinkNoise}}
\index{GeneratePinkNoise@{GeneratePinkNoise}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{GeneratePinkNoise()}{GeneratePinkNoise()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_acfbee971d40a150d4a00611ed7b69cd3} 
float Generate\+Pink\+Noise (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_pink_noise}{Pink\+Noise}} \texorpdfstring{$\ast$}{*}}]{pink}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00153\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordtype}{long}\ newRandom;}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordtype}{long}\ sum;}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordtype}{float}\ output;}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{/*\ Increment\ and\ mask\ index.\ */}}
\DoxyCodeLine{00158\ \ \ \ \ pink-\/>pink\_Index\ =\ (pink-\/>pink\_Index\ +\ 1)\ \&\ pink-\/>pink\_IndexMask;}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{comment}{/*\ If\ index\ is\ zero,\ don't\ update\ any\ random\ values.\ */}}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{if}(\ pink-\/>pink\_Index\ !=\ 0\ )}
\DoxyCodeLine{00161\ \ \ \ \ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Determine\ how\ many\ trailing\ zeros\ in\ PinkIndex.\ */}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ This\ algorithm\ will\ hang\ if\ n==0\ so\ test\ first.\ */}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ numZeros\ =\ 0;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ pink-\/>pink\_Index;}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}(\ (n\ \&\ 1)\ ==\ 0\ )}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ n\ =\ n\ >>\ 1;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ numZeros++;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Replace\ the\ indexed\ ROWS\ random\ value.}}
\DoxyCodeLine{00172\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ Subtract\ and\ add\ back\ to\ RunningSum\ instead\ of\ adding\ all\ the\ random}}
\DoxyCodeLine{00173\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ *\ values\ together.\ Only\ one\ changes\ each\ time.}}
\DoxyCodeLine{00174\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ pink-\/>pink\_RunningSum\ -\/=\ pink-\/>pink\_Rows[numZeros];}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ newRandom\ =\ ((long)GenerateRandomNumber())\ >>\ PINK\_RANDOM\_SHIFT;}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ pink-\/>pink\_RunningSum\ +=\ newRandom;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ pink-\/>pink\_Rows[numZeros]\ =\ newRandom;}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{/*\ Add\ extra\ white\ noise\ value.\ */}}
\DoxyCodeLine{00182\ \ \ \ \ newRandom\ =\ ((long)GenerateRandomNumber())\ >>\ PINK\_RANDOM\_SHIFT;}
\DoxyCodeLine{00183\ \ \ \ \ sum\ =\ pink-\/>pink\_RunningSum\ +\ newRandom;}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{/*\ Scale\ to\ range\ of\ -\/1.0\ to\ 0.9999.\ */}}
\DoxyCodeLine{00185\ \ \ \ \ output\ =\ pink-\/>pink\_Scalar\ *\ sum;}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordflow}{return}\ output;}
\DoxyCodeLine{00187\ \}}

\end{DoxyCode}
\Hypertarget{paex__ocean__shore_8c_aac16b3933990e9a8bddb66b509789dae}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!GenerateWave@{GenerateWave}}
\index{GenerateWave@{GenerateWave}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{GenerateWave()}{GenerateWave()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_aac16b3933990e9a8bddb66b509789dae} 
unsigned Generate\+Wave (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_ocean_wave}{Ocean\+Wave}} \texorpdfstring{$\ast$}{*}}]{wave}{, }\item[{float \texorpdfstring{$\ast$}{*}}]{output}{, }\item[{unsigned}]{no\+Of\+Frames}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00202\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ retval=0,i;}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{float}\ targetLevel,\ levelIncr,\ currentLevel;}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{switch}\ (wave-\/>wave\_envelope\_state)}
\DoxyCodeLine{00206\ \ \ \ \ \{}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordflow}{case}\ State\_kAttack:}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ targetLevel\ =\ noOfFrames\ *\ wave-\/>wave\_attack\_incr\ +\ wave-\/>wave\_envelope\_level;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (targetLevel\ >=\ wave-\/>wave\_envelope\_max\_level)}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Go\ to\ decay\ state\ */}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_state\ =\ State\_kPreDecay;}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ targetLevel\ =\ wave-\/>wave\_envelope\_max\_level;}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Calculate\ lowpass\ biquad\ coeffs}}
\DoxyCodeLine{00216\ \textcolor{comment}{}}
\DoxyCodeLine{00217\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ alpha\ =\ sin(w0)/(2*Q)}}
\DoxyCodeLine{00218\ \textcolor{comment}{}}
\DoxyCodeLine{00219\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b0\ =\ \ (1\ -\/\ cos(w0))/2}}
\DoxyCodeLine{00220\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b1\ =\ \ \ 1\ -\/\ cos(w0)}}
\DoxyCodeLine{00221\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b2\ =\ \ (1\ -\/\ cos(w0))/2}}
\DoxyCodeLine{00222\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ a0\ =\ \ \ 1\ +\ alpha}}
\DoxyCodeLine{00223\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ a1\ =\ \ -\/2*cos(w0)}}
\DoxyCodeLine{00224\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ a2\ =\ \ \ 1\ -\/\ alpha}}
\DoxyCodeLine{00225\ \textcolor{comment}{}}
\DoxyCodeLine{00226\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ w0\ =\ [0\ -\/\ pi[}}
\DoxyCodeLine{00227\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ w0\ =\ 3.141592654f\ *\ targetLevel\ /\ wave-\/>wave\_envelope\_max\_level;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ alpha\ =\ sinf(w0)\ *\ one\_over\_2Q\_LP;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ cosw0\ =\ cosf(w0);}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ a0\_fact\ =\ 1.0f\ /\ (1.0f\ +\ alpha);}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b1\ =\ (1.0f\ -\/\ cosw0)\ *\ a0\_fact;}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b0\ =\ wave-\/>wave\_bq\_coeffs.bq\_b1\ *\ 0.5f;}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b2\ =\ wave-\/>wave\_bq\_coeffs.bq\_b0;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_a2\ =\ (1.0f\ -\/\ alpha)\ *\ a0\_fact;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_a1\ =\ -\/2.0f\ *\ cosw0\ *\ a0\_fact;}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{case}\ State\_kPreDecay:}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Reset\ biquad\ state\ */}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ memset(wave-\/>wave\_bq\_left,\ 0,\ 2\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ memset(wave-\/>wave\_bq\_right,\ 0,\ 2\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}));}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_state\ =\ State\_kDecay;}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Deliberate\ fall-\/through\ */}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{case}\ State\_kDecay:}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ targetLevel\ =\ noOfFrames\ *\ wave-\/>wave\_decay\_incr\ +\ wave-\/>wave\_envelope\_level;}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (targetLevel\ <\ 0.001f)}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ <\ -\/60\ dB,\ we're\ done\ */}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_state\ =\ 3;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ 1;}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Calculate\ highpass\ biquad\ coeffs}}
\DoxyCodeLine{00258\ \textcolor{comment}{}}
\DoxyCodeLine{00259\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ alpha\ =\ sin(w0)/(2*Q)}}
\DoxyCodeLine{00260\ \textcolor{comment}{}}
\DoxyCodeLine{00261\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ b0\ =\ \ (1\ +\ cos(w0))/2}}
\DoxyCodeLine{00262\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ b1\ =\ -\/(1\ +\ cos(w0))}}
\DoxyCodeLine{00263\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ b2\ =\ \ (1\ +\ cos(w0))/2}}
\DoxyCodeLine{00264\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ a0\ =\ \ \ 1\ +\ alpha}}
\DoxyCodeLine{00265\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ a1\ =\ \ -\/2*cos(w0)}}
\DoxyCodeLine{00266\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ a2\ =\ \ \ 1\ -\/\ alpha}}
\DoxyCodeLine{00267\ \textcolor{comment}{}}
\DoxyCodeLine{00268\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ w0\ =\ [0\ -\/\ pi/2[}}
\DoxyCodeLine{00269\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ v\ =\ targetLevel\ /\ wave-\/>wave\_envelope\_max\_level;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ w0\ =\ 1.5707963f\ *\ (1.0f\ -\/\ (v*v));}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ alpha\ =\ sinf(w0)\ *\ one\_over\_2Q\_HP;}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ cosw0\ =\ cosf(w0);}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ a0\_fact\ =\ 1.0f\ /\ (1.0f\ +\ alpha);}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b1\ =\ (float)(-\/\ (1\ +\ cosw0)\ *\ a0\_fact);}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b0\ =\ -\/wave-\/>wave\_bq\_coeffs.bq\_b1\ *\ 0.5f;}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_b2\ =\ wave-\/>wave\_bq\_coeffs.bq\_b0;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_a2\ =\ (float)((1.0\ -\/\ alpha)\ *\ a0\_fact);}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ wave-\/>wave\_bq\_coeffs.bq\_a1\ =\ (float)(-\/2.0\ *\ cosw0\ *\ a0\_fact);}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00286\ \ \ \ \ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ currentLevel\ =\ wave-\/>wave\_envelope\_level;}
\DoxyCodeLine{00289\ \ \ \ \ wave-\/>wave\_envelope\_level\ =\ targetLevel;}
\DoxyCodeLine{00290\ \ \ \ \ levelIncr\ =\ (targetLevel\ -\/\ currentLevel)\ /\ noOfFrames;}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ noOfFrames;\ ++i,\ currentLevel\ +=\ levelIncr)}
\DoxyCodeLine{00293\ \ \ \ \ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ (*output++)\ +=\ ProcessBiquad(\&wave-\/>wave\_bq\_coeffs,\ wave-\/>wave\_bq\_left,\ (GeneratePinkNoise(\&wave-\/>wave\_left)))\ *\ currentLevel\ *\ wave-\/>wave\_pan\_left;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ (*output++)\ +=\ ProcessBiquad(\&wave-\/>wave\_bq\_coeffs,\ wave-\/>wave\_bq\_right,\ (GeneratePinkNoise(\&wave-\/>wave\_right)))\ *\ currentLevel\ *\ wave-\/>wave\_pan\_right;}
\DoxyCodeLine{00296\ \ \ \ \ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{return}\ retval;}
\DoxyCodeLine{00299\ \}}

\end{DoxyCode}
\Hypertarget{paex__ocean__shore_8c_af0dae67ebb88c9e578848aa1fceaf8f8}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!InitializePinkNoise@{InitializePinkNoise}}
\index{InitializePinkNoise@{InitializePinkNoise}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{InitializePinkNoise()}{InitializePinkNoise()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_af0dae67ebb88c9e578848aa1fceaf8f8} 
void Initialize\+Pink\+Noise (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_pink_noise}{Pink\+Noise}} \texorpdfstring{$\ast$}{*}}]{pink}{, }\item[{int}]{num\+Rows}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00138\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordtype}{long}\ pmax;}
\DoxyCodeLine{00141\ \ \ \ \ pink-\/>pink\_Index\ =\ 0;}
\DoxyCodeLine{00142\ \ \ \ \ pink-\/>pink\_IndexMask\ =\ (1<<numRows)\ -\/\ 1;}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{/*\ Calculate\ maximum\ possible\ signed\ random\ value.\ Extra\ 1\ for\ white\ noise\ always\ added.\ */}}
\DoxyCodeLine{00144\ \ \ \ \ pmax\ =\ (numRows\ +\ 1)\ *\ (1<<(PINK\_RANDOM\_BITS-\/1));}
\DoxyCodeLine{00145\ \ \ \ \ pink-\/>pink\_Scalar\ =\ 1.0f\ /\ pmax;}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ rows.\ */}}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{for}(\ i=0;\ i<numRows;\ i++\ )\ pink-\/>pink\_Rows[i]\ =\ 0;}
\DoxyCodeLine{00148\ \ \ \ \ pink-\/>pink\_RunningSum\ =\ 0;}
\DoxyCodeLine{00149\ \}}

\end{DoxyCode}
\Hypertarget{paex__ocean__shore_8c_a6f53cca6e132a7847315f74f04a50340}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!InitializeWave@{InitializeWave}}
\index{InitializeWave@{InitializeWave}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{InitializeWave()}{InitializeWave()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_a6f53cca6e132a7847315f74f04a50340} 
\mbox{\hyperlink{struct_ocean_wave}{Ocean\+Wave}} \texorpdfstring{$\ast$}{*} Initialize\+Wave (\begin{DoxyParamCaption}\item[{double}]{SR}{, }\item[{float}]{attack\+In\+Seconds}{, }\item[{float}]{max\+Level}{, }\item[{float}]{position\+Left\+Right}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00365\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*\ wave\ =\ NULL;}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ lastNoOfRows\ =\ 12;}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ newNoOfRows;}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ wave\ =\ (\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*)PaUtil\_AllocateZeroInitializedMemory(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}));}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keywordflow}{if}\ (wave\ !=\ NULL)}
\DoxyCodeLine{00372\ \ \ \ \ \{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ InitializePinkNoise(\&wave-\/>wave\_left,\ lastNoOfRows);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((newNoOfRows\ =\ NEW\_ROW\_SIZE)\ ==\ lastNoOfRows);}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ InitializePinkNoise(\&wave-\/>wave\_right,\ newNoOfRows);}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ lastNoOfRows\ =\ newNoOfRows;}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_state\ =\ State\_kAttack;}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_level\ =\ 0.f;}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ wave-\/>wave\_envelope\_max\_level\ =\ maxLevel;}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ wave-\/>wave\_attack\_incr\ =\ wave-\/>wave\_envelope\_max\_level\ /\ (attackInSeconds\ *\ (float)SR);}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ wave-\/>wave\_decay\_incr\ =\ -\/\ wave-\/>wave\_envelope\_max\_level\ /\ (attackInSeconds\ *\ 4\ *\ (float)SR);}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ wave-\/>wave\_pan\_left\ =\ sqrtf(1.0f\ -\/\ positionLeftRight);}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ wave-\/>wave\_pan\_right\ =\ sqrtf(positionLeftRight);}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{return}\ wave;}
\DoxyCodeLine{00388\ \}}

\end{DoxyCode}
\Hypertarget{paex__ocean__shore_8c_a840291bc02cba5474a4cb46a9b9566fe}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!main@{main}}
\index{main@{main}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_a840291bc02cba5474a4cb46a9b9566fe} 
int main (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00398\ \{}
\DoxyCodeLine{00399\ \ \ \ \ PaStream*\ \ \ \ \ \ \ \ \ \ \ stream;}
\DoxyCodeLine{00400\ \ \ \ \ PaError\ \ \ \ \ \ \ \ \ \ \ \ \ err;}
\DoxyCodeLine{00401\ \ \ \ \ \mbox{\hyperlink{structpa_test_data}{paTestData}}\ \ \ \ \ \ \ \ \ \ data\ =\ \{0\};}
\DoxyCodeLine{00402\ \ \ \ \ PaStreamParameters\ \ outputParameters;}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keywordtype}{double}\ \ \ \ \ \ \ \ \ \ \ \ \ \ tstamp;}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordtype}{double}\ \ \ \ \ \ \ \ \ \ \ \ \ \ tstart;}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keywordtype}{double}\ \ \ \ \ \ \ \ \ \ \ \ \ \ tdelta\ =\ 0;}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ SR\ \ =\ 44100.0;}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ \ \ \ FPB\ =\ 128;\ \textcolor{comment}{/*\ Frames\ per\ buffer:\ 2.9\ ms\ buffers.\ */}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{comment}{/*\ Initialize\ communication\ buffers\ (queues)\ */}}
\DoxyCodeLine{00410\ \ \ \ \ data.rBufToRTData\ =\ PaUtil\_AllocateZeroInitializedMemory(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*)\ *\ 256);}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordflow}{if}\ (data.rBufToRTData\ ==\ NULL)}
\DoxyCodeLine{00412\ \ \ \ \ \{}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00414\ \ \ \ \ \}}
\DoxyCodeLine{00415\ \ \ \ \ PaUtil\_InitializeRingBuffer(\&data.rBufToRT,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*),\ 256,\ data.rBufToRTData);}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \ \ data.rBufFromRTData\ =\ PaUtil\_AllocateZeroInitializedMemory(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*)\ *\ 256);}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordflow}{if}\ (data.rBufFromRTData\ ==\ NULL)}
\DoxyCodeLine{00419\ \ \ \ \ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00421\ \ \ \ \ \}}
\DoxyCodeLine{00422\ \ \ \ \ PaUtil\_InitializeRingBuffer(\&data.rBufFromRT,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*),\ 256,\ data.rBufFromRTData);}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ err\ =\ Pa\_Initialize();}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}(\ err\ !=\ paNoError\ )\ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \ \ \textcolor{comment}{/*\ Open\ a\ stereo\ PortAudio\ stream\ so\ we\ can\ hear\ the\ result.\ */}}
\DoxyCodeLine{00428\ \ \ \ \ outputParameters.device\ =\ Pa\_GetDefaultOutputDevice();\ \textcolor{comment}{/*\ Take\ the\ default\ output\ device.\ */}}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{if}\ (outputParameters.device\ ==\ paNoDevice)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ fprintf(stderr,\textcolor{stringliteral}{"{}Error:\ No\ default\ output\ device.\(\backslash\)n"{}});}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00432\ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \ \ outputParameters.channelCount\ =\ 2;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Stereo\ output,\ most\ likely\ supported.\ */}}
\DoxyCodeLine{00434\ \ \ \ \ outputParameters.hostApiSpecificStreamInfo\ =\ NULL;}
\DoxyCodeLine{00435\ \ \ \ \ outputParameters.sampleFormat\ =\ paFloat32;\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ 32\ bit\ floating\ point\ output.\ */}}
\DoxyCodeLine{00436\ \ \ \ \ outputParameters.suggestedLatency\ =\ Pa\_GetDeviceInfo(outputParameters.device)-\/>defaultLowOutputLatency;}
\DoxyCodeLine{00437\ \ \ \ \ err\ =\ Pa\_OpenStream(\&stream,}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NULL,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ No\ input.\ */}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&outputParameters,}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SR,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Sample\ rate.\ */}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FPB,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Frames\ per\ buffer.\ */}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ paDitherOff,\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Clip\ but\ don't\ dither\ */}}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ patestCallback,}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&data);}
\DoxyCodeLine{00445\ \ \ \ \ \textcolor{keywordflow}{if}(\ err\ !=\ paNoError\ )\ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \ \ \ \ err\ =\ Pa\_StartStream(\ stream\ );}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordflow}{if}(\ err\ !=\ paNoError\ )\ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ printf(\textcolor{stringliteral}{"{}Stereo\ \(\backslash\)"{}ocean\ waves\(\backslash\)"{}\ for\ one\ minute...\(\backslash\)n"{}});}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \ \ tstart\ =\ PaUtil\_GetTime();}
\DoxyCodeLine{00453\ \ \ \ \ tstamp\ =\ tstart;}
\DoxyCodeLine{00454\ \ \ \ \ srand(\ (\textcolor{keywordtype}{unsigned})time(NULL)\ );}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \ \ \textcolor{keywordflow}{while}(\ (\ err\ =\ Pa\_IsStreamActive(\ stream\ )\ )\ ==\ 1\ )}
\DoxyCodeLine{00457\ \ \ \ \ \{}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ tcurrent\ =\ PaUtil\_GetTime();}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Delete\ "{}waves"{}\ that\ the\ callback\ is\ finished\ with\ */}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (PaUtil\_GetRingBufferReadAvailable(\&data.rBufFromRT)\ >\ 0)}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*\ ptr\ =\ 0;}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ PaUtil\_ReadRingBuffer(\&data.rBufFromRT,\ \&ptr,\ 1);}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ptr\ !=\ 0)}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Wave\ is\ deleted...\(\backslash\)n"{}});}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PaUtil\_FreeMemory(ptr);}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/data.noOfActiveWaves;}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tcurrent\ -\/\ tstart\ <\ 60.0)\ \textcolor{comment}{/*\ Only\ start\ new\ "{}waves"{}\ during\ one\ minute\ */}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tcurrent\ >=\ tstamp)}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ tdelta\ =\ GenerateFloatRandom(1.0f,\ 4.0f);}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tstamp\ +=\ tdelta;}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (data.noOfActiveWaves<16)}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ attackTime\ =\ GenerateFloatRandom(2.0f,\ 6.0f);}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ level\ =\ GenerateFloatRandom(0.1f,\ 1.0f);}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ pos\ =\ GenerateFloatRandom(0.0f,\ 1.0f);}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_ocean_wave}{OceanWave}}*\ p\ =\ InitializeWave(SR,\ attackTime,\ level,\ pos);}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (p\ !=\ NULL)}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Post\ wave\ to\ audio\ callback\ */}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PaUtil\_WriteRingBuffer(\&data.rBufToRT,\ \&p,\ 1);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++data.noOfActiveWaves;}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}Starting\ wave\ at\ level\ =\ \%.2f,\ attack\ =\ \%.2lf,\ pos\ =\ \%.2lf\(\backslash\)n"{}},\ level,\ attackTime,\ pos);}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (data.noOfActiveWaves\ ==\ 0)}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf(\textcolor{stringliteral}{"{}All\ waves\ finished!\(\backslash\)n"{}});}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ Pa\_Sleep(100);}
\DoxyCodeLine{00507\ \ \ \ \ \}}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordflow}{if}(\ err\ <\ 0\ )\ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \ \ \ \ err\ =\ Pa\_CloseStream(\ stream\ );}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordflow}{if}(\ err\ !=\ paNoError\ )\ \textcolor{keywordflow}{goto}\ error;}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordflow}{if}\ (data.rBufToRTData)}
\DoxyCodeLine{00514\ \ \ \ \ \{}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ PaUtil\_FreeMemory(data.rBufToRTData);}
\DoxyCodeLine{00516\ \ \ \ \ \}}
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{keywordflow}{if}\ (data.rBufFromRTData)}
\DoxyCodeLine{00518\ \ \ \ \ \{}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ PaUtil\_FreeMemory(data.rBufFromRTData);}
\DoxyCodeLine{00520\ \ \ \ \ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ \ \ Pa\_Sleep(1000);}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ Pa\_Terminate();}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ error:}
\DoxyCodeLine{00528\ \ \ \ \ Pa\_Terminate();}
\DoxyCodeLine{00529\ \ \ \ \ fprintf(\ stderr,\ \textcolor{stringliteral}{"{}An\ error\ occurred\ while\ using\ the\ portaudio\ stream\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00530\ \ \ \ \ fprintf(\ stderr,\ \textcolor{stringliteral}{"{}Error\ number:\ \%d\(\backslash\)n"{}},\ err\ );}
\DoxyCodeLine{00531\ \ \ \ \ fprintf(\ stderr,\ \textcolor{stringliteral}{"{}Error\ message:\ \%s\(\backslash\)n"{}},\ Pa\_GetErrorText(\ err\ )\ );}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00533\ \}}

\end{DoxyCode}
\Hypertarget{paex__ocean__shore_8c_aa24e8a7f0ab18cae3d70fc59689e4273}\index{paex\_ocean\_shore.c@{paex\_ocean\_shore.c}!ProcessBiquad@{ProcessBiquad}}
\index{ProcessBiquad@{ProcessBiquad}!paex\_ocean\_shore.c@{paex\_ocean\_shore.c}}
\doxysubsubsection{\texorpdfstring{ProcessBiquad()}{ProcessBiquad()}}
{\footnotesize\ttfamily \label{paex__ocean__shore_8c_aa24e8a7f0ab18cae3d70fc59689e4273} 
float Process\+Biquad (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{struct_bi_quad}{Bi\+Quad}} \texorpdfstring{$\ast$}{*}}]{coeffs}{, }\item[{float \texorpdfstring{$\ast$}{*}}]{memory}{, }\item[{float}]{input}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00190\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{float}\ w\ =\ input\ -\/\ coeffs-\/>bq\_a1\ *\ memory[0]\ -\/\ coeffs-\/>bq\_a2\ *\ memory[1];}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{float}\ out\ =\ coeffs-\/>bq\_b1\ *\ memory[0]\ +\ coeffs-\/>bq\_b2\ *\ memory[1]\ +\ coeffs-\/>bq\_b0\ *\ w;}
\DoxyCodeLine{00193\ \ \ \ \ memory[1]\ =\ memory[0];}
\DoxyCodeLine{00194\ \ \ \ \ memory[0]\ =\ w;}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{return}\ out;}
\DoxyCodeLine{00196\ \}}

\end{DoxyCode}
